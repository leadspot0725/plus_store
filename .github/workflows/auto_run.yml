name: Run Keyword Collector

on:
  workflow_dispatch:  # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥
  schedule:
    - cron: '0 0 * * *'  # ë§¤ì¼ ìì •ì— ì‹¤í–‰ (UTC ê¸°ì¤€)

permissions:
  contents: read   # Repository íŒŒì¼ ì½ê¸° ê¶Œí•œ

jobs:
  build:
    runs-on: ubuntu-latest  # ìµœì‹  Ubuntu í™˜ê²½ ì‚¬ìš©
    timeout-minutes: 30  # ìµœëŒ€ ì‹¤í–‰ ì‹œê°„ ì„¤ì •

    steps:
      # 1ï¸âƒ£ ì €ì¥ì†Œ ì²´í¬ì•„ì›ƒ (GitHub Actionsì—ì„œ ì½”ë“œ ê°€ì ¸ì˜¤ê¸°)
      - name: ì €ì¥ì†Œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4

      # 2ï¸âƒ£ Python ì„¤ì • (ë²„ì „ 3.10 ì‚¬ìš©)
      - name: Python 3.10 ì„¤ì •
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"
          cache: 'pip'  # ì˜ì¡´ì„± ìºì‹± í™œì„±í™”

      # 3ï¸âƒ£ Google Cloud ì¸ì¦ (ì„œë¹„ìŠ¤ ê³„ì • í‚¤ ì‚¬ìš©)
      - name: Google Cloud ì¸ì¦ ì„¤ì •
        run: |
          echo '${{ secrets.GOOGLE_CREDENTIALS }}' > /tmp/credentials.json
          echo "GOOGLE_APPLICATION_CREDENTIALS=/tmp/credentials.json" >> $GITHUB_ENV

      # 4ï¸âƒ£ í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
      - name: í•„ìš”í•œ Python íŒ¨í‚¤ì§€ ì„¤ì¹˜
        run: |
          pip install --upgrade pip
          pip install -r requirements.txt

      # 5ï¸âƒ£ Chrome ì„¤ì¹˜ í™•ì¸ ë° ì—…ë°ì´íŠ¸
      - name: Chrome ì„¤ì¹˜ í™•ì¸
        run: |
          echo "ğŸŸ¢ í˜„ì¬ ì„¤ì¹˜ëœ Chrome ë²„ì „ í™•ì¸"
          google-chrome --version || echo "âš ï¸ Chromeì´ ì„¤ì¹˜ë˜ì§€ ì•ŠìŒ"
          
          echo "ğŸŸ¢ Chrome ìµœì‹  ë²„ì „ìœ¼ë¡œ ì—…ë°ì´íŠ¸"
          sudo apt-get update
          sudo apt-get install -y google-chrome-stable
          
          echo "ğŸŸ¢ ì—…ë°ì´íŠ¸ í›„ Chrome ë²„ì „ í™•ì¸"
          google-chrome --version

      # 6ï¸âƒ£ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ (ì—°ê´€ í‚¤ì›Œë“œ í¬ë¡¤ë§)
      - name: Run Python Keyword Collector
        run: python keyword_collector.py
        env:
          PYTHONUNBUFFERED: 1  # ë¡œê·¸ ë²„í¼ë§ ë°©ì§€

      # 7ï¸âƒ£ ì‹¤í–‰ ê²°ê³¼ ë¡œê·¸ ì €ì¥
      - name: ë¡œê·¸ ì•„í‹°íŒ©íŠ¸ ì €ì¥
        if: always()  # ì„±ê³µ/ì‹¤íŒ¨ì™€ ê´€ê³„ì—†ì´ í•­ìƒ ì‹¤í–‰
        uses: actions/upload-artifact@v4
        with:
          name: keyword-collector-logs
          path: |
            keyword_collector.log
            *.log
