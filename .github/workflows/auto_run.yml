name: Run Keyword Collector

on:
  workflow_dispatch:  # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

permissions:
  id-token: write  # Workload Identity Federationì„ ìœ„í•œ ê¶Œí•œ ì„¤ì •
  contents: read   # Repository íŒŒì¼ ì½ê¸° ê¶Œí•œ

jobs:
  build:
    runs-on: ubuntu-latest  # ìµœì‹  Ubuntu í™˜ê²½ ì‚¬ìš©
    steps:

      # 1ï¸âƒ£ ì €ì¥ì†Œ ì²´í¬ì•„ì›ƒ (GitHub Actionsì—ì„œ ì½”ë“œ ê°€ì ¸ì˜¤ê¸°)
      - name: ì €ì¥ì†Œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4

      # 2ï¸âƒ£ Python ì„¤ì • (ë²„ì „ 3.10 ì‚¬ìš©)
      - name: Python 3.10 ì„¤ì •
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"

      # 3ï¸âƒ£ Google Cloud ì¸ì¦ (Workload Identity Federation)
      - name: Google Cloud ì¸ì¦ (OIDC ì‚¬ìš©)
        uses: google-github-actions/auth@v1
        with:
          workload_identity_provider: ${{ secrets.WORKLOAD_IDENTITY_PROVIDER }}
          service_account: ${{ secrets.SERVICE_ACCOUNT }}
          create_credentials_file: true
          export_environment_variables: true

      # 4ï¸âƒ£ í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
      - name: í•„ìš”í•œ Python íŒ¨í‚¤ì§€ ì„¤ì¹˜
        run: |
          pip install --upgrade pip
          pip install -r requirements.txt

      # 5ï¸âƒ£ Chrome ë° ChromeDriver ì„¤ì¹˜ ì œê±° (í…ŒìŠ¤íŠ¸ ì‹¤í–‰)
      - name: Chrome & ChromeDriver ì„¤ì¹˜ í™•ì¸
        run: |
          echo "ğŸŸ¢ í˜„ì¬ ì„¤ì¹˜ëœ Chrome ë° ChromeDriver í™•ì¸"
          google-chrome --version || echo "âš ï¸ Chromeì´ ì„¤ì¹˜ë˜ì§€ ì•ŠìŒ"
          chromedriver --version || echo "âš ï¸ ChromeDriverê°€ ì„¤ì¹˜ë˜ì§€ ì•ŠìŒ"

      # 6ï¸âƒ£ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ (ì—°ê´€ í‚¤ì›Œë“œ í¬ë¡¤ë§)
      - name: Run Python Keyword Collector
        run: python keyword_collector.py
