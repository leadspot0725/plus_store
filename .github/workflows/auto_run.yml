name: Run Keyword Collector

on:
  workflow_dispatch:  # 수동 실행 가능

permissions:
  id-token: write  # Workload Identity Federation을 위한 권한 설정
  contents: read   # Repository 파일 읽기 권한

jobs:
  build:
    runs-on: ubuntu-latest  # 최신 Ubuntu 환경 사용
    steps:

      # 1️⃣ 저장소 체크아웃 (GitHub Actions에서 코드 가져오기)
      - name: 저장소 체크아웃
        uses: actions/checkout@v4

      # 2️⃣ Python 설정 (버전 3.10 사용)
      - name: Python 3.10 설정
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"

      # 3️⃣ Google Cloud 인증 (Workload Identity Federation)
      - name: Google Cloud 인증 (OIDC 사용)
        uses: google-github-actions/auth@v1
        with:
          workload_identity_provider: ${{ secrets.WORKLOAD_IDENTITY_PROVIDER }}
          service_account: ${{ secrets.SERVICE_ACCOUNT }}
          create_credentials_file: true
          export_environment_variables: true

      # 4️⃣ 필수 라이브러리 설치
      - name: 필요한 Python 패키지 설치
        run: |
          pip install --upgrade pip
          pip install -r requirements.txt

      # 5️⃣ Chrome 및 ChromeDriver 설치 제거 (테스트 실행)
      - name: Chrome & ChromeDriver 설치 확인
        run: |
          echo "🟢 현재 설치된 Chrome 및 ChromeDriver 확인"
          google-chrome --version || echo "⚠️ Chrome이 설치되지 않음"
          chromedriver --version || echo "⚠️ ChromeDriver가 설치되지 않음"

      # 6️⃣ 스크립트 실행 (연관 키워드 크롤링)
      - name: Run Python Keyword Collector
        run: python keyword_collector.py
